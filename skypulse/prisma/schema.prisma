generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id               String         @id @default(cuid())
  email            String         @unique
  passwordHash     String
  isVerified       Boolean        @default(false)
  preferredOrigin  String?
  preferredMaxPrice Int?
  notificationEmail String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  subscriptions    Subscription[]
  verificationTokens VerificationToken[]
}

model VerificationToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Subscription {
  id           String   @id @default(cuid())
  userId       String
  prompt       String
  origin       String?
  destination  String?
  maxPrice     Int?
  startDate    String?
  endDate      String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())

  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  matchedDeals Deal[]
}

model Deal {
  id             String        @id @default(cuid())
  subscriptionId String
  airline        String
  flightNumber   String?
  departureCity  String
  arrivalCity    String
  departureDate  DateTime
  returnDate     DateTime?
  price          Int
  bookingLink    String
  reasonToBuy    String
  foundAt        DateTime      @default(now())

  subscription   Subscription  @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
}
